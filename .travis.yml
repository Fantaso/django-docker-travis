sudo: required

services:
  - docker
  - postgresql

before_install:
  - docker --version
  - docker-compose --version
  # - echo "ENV GIT_SHA ${TRAVIS_COMMIT}" >> Dockerfile
  - docker volume create --name=db_data
  - docker-compose build tests
  - docker-compose build db

  # - docker build -t fantaso/django-docker-travis -f wine_ecommerce/Dockerfile

script:
  - docker-compose run db
  - docker-compose run tests python manage.py makemigrations
  - docker-compose run tests python manage.py migrate
  - docker-compose run tests python manage.py test shop
  # - docker run fantaso/django-docker-travis wine_ecommerce/python manage.py test shop

# deploy:
#   provider: elasticbeanstalk # service to deploy
#   region: eu-central-1 # region of the EBS instance
#   app: 'django-docker-travis' # name of the app we named the EBS instance
#   env: 'django-docker-travis-env' # name of environment created by EBS
#   bucket_name: 'elasticbeanstalk-eu-central-1-472973582080' # bucket S3 created when a elasticbeanstalk environment was created
#   bucket_path: 'django-docker-travis' # a folder thats created automatically in the S3 bucket once deployed. the same name as the app name.
#   access_key_id: $AWS_ACCESS_KEY # this key must be configure in travisCI environmental variables
#   secret_access_id:
#     secure: '$AWS_SECRET_KEY' # this key must be configure in travisCI environmental variables
#   on:
#     branch: master # only if changes occured in master branch is deployed
